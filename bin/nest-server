#!/bin/bash

pid() {
  pgrep -f 'python3 /opt/nest-server/app/main.py'
}

status() {
  export pid=`nest-server pid`
  if [ $pid ]; then
    echo 'NEST Server is running.'
  else
    echo 'NEST Server is not running.'
  fi
}

start() {
  export pid=`nest-server pid`
  if [ $pid ]; then
    echo 'NEST Server is already running.'
  else
    python3 /opt/nest-server/app/main.py &
    echo 'NEST Server is started.'
  fi
}

stop() {
  export pid=`nest-server pid`
  if [ $pid ]; then
    kill $pid
    echo 'NEST Server has stopped.'
  fi
}

case "$1" in
  pid) pid ;;
  status)  status ;;
  start)   start ;;
  stop)    stop ;;
  restart) stop; start ;;
  *) echo "usage: $0 pid|status|start|stop|restart" >&2
     exit 1
     ;;
esac
